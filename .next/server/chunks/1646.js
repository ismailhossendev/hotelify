"use strict";exports.id=1646,exports.ids=[1646],exports.modules={31646:(e,t,i)=>{i.r(t),i.d(t,{Offer:()=>n});var o=i(11185),s=i.n(o);let a=new(s()).Schema({code:{type:String,required:!0,uppercase:!0,trim:!0,index:!0},title:{type:String,required:!0},description:String,createdBy:{type:s().Schema.Types.ObjectId,ref:"User",required:!0},scope:{type:String,enum:["platform","hotel"],required:!0,default:"hotel"},hotelId:{type:s().Schema.Types.ObjectId,ref:"Hotel"},discountType:{type:String,enum:["percentage","fixed"],required:!0,default:"percentage"},discountValue:{type:Number,required:!0},minBookingAmount:{type:Number,default:0},maxDiscountAmount:Number,applicableHotels:[{type:s().Schema.Types.ObjectId,ref:"Hotel"}],applicableRoomTypes:[String],validFrom:{type:Date,default:Date.now},validUntil:{type:Date,required:!0},usageLimit:{type:Number,default:0},usageCount:{type:Number,default:0},usageLimitPerUser:{type:Number,default:0},isActive:{type:Boolean,default:!0},isAutoApply:{type:Boolean,default:!1},isFirstBookingOnly:{type:Boolean,default:!1},isPublic:{type:Boolean,default:!1},image:String,bgColor:{type:String,default:"bg-gradient-to-br from-blue-500 to-cyan-500"},priority:{type:Number,default:0},showOnHome:{type:Boolean,default:!1},redemptions:[{bookingId:{type:s().Schema.Types.ObjectId,ref:"Booking"},userId:{type:s().Schema.Types.ObjectId,ref:"User"},hotelId:{type:s().Schema.Types.ObjectId,ref:"Hotel"},discountAmount:Number,redeemedAt:{type:Date,default:Date.now}}]},{timestamps:!0});a.index({code:1,hotelId:1},{unique:!0}),a.index({scope:1,isActive:1}),a.index({validFrom:1,validUntil:1}),a.index({isPublic:1,isActive:1}),a.virtual("isValid").get(function(){let e=new Date;return this.isActive&&e>=this.validFrom&&e<=this.validUntil&&(0===this.usageLimit||this.usageCount<this.usageLimit)}),a.methods.validateForBooking=function(e,t){let i=[],o=new Date;return this.isActive||i.push("This offer is no longer active"),o<this.validFrom&&i.push("This offer is not yet valid"),o>this.validUntil&&i.push("This offer has expired"),this.usageLimit>0&&this.usageCount>=this.usageLimit&&i.push("This offer has reached its usage limit"),t<this.minBookingAmount&&i.push(`Minimum booking amount is à§³${this.minBookingAmount}`),"platform"===this.scope&&this.applicableHotels?.length>0&&!this.applicableHotels.some(t=>t.toString()===e)&&i.push("This offer is not applicable for this hotel"),"hotel"===this.scope&&this.hotelId?.toString()!==e&&i.push("This offer is not applicable for this hotel"),{valid:0===i.length,errors:i}},a.methods.calculateDiscount=function(e){let t=0;return"percentage"===this.discountType?(t=e*this.discountValue/100,this.maxDiscountAmount&&t>this.maxDiscountAmount&&(t=this.maxDiscountAmount)):t=this.discountValue,Math.min(t,e)};let n=s().models.Offer||s().model("Offer",a)}};